function Shatter(a,b,c){this.img=a,this.numPolys=b,this.images=[];var d,c=c||1;d=this.getPolys(a.width,a.height,b),this.roundVertices(d),this.calcBoundaries(d,this.img),this.scaleCoordinates(d,c),this.images=this.spliceImage(d,a)}!function(){function a(a){return null!=a&&!isNaN(a)}function b(a){return a.length}function c(a){for(var b=1;a*b%1;)b*=10;return b}function d(a,b){try{for(var c in b)Object.defineProperty(a.prototype,c,{value:b[c],enumerable:!1})}catch(d){a.prototype=b}}function e(){}function f(a){return U+a in this}function g(a){return a=U+a,a in this&&delete this[a]}function h(){var a=[];return this.forEach(function(b){a.push(b)}),a}function i(){var a=0;for(var b in this)b.charCodeAt(0)===V&&++a;return a}function j(){for(var a in this)if(a.charCodeAt(0)===V)return!1;return!0}function k(){}function l(a){return"function"==typeof a?a:function(){return a}}function m(){I(this),this.edge=this.site=this.circle=null}function n(a){var b=bb.pop()||new m;return b.site=a,b}function o(a){y(a),Y.remove(a),bb.push(a),I(a)}function p(a){var b=a.circle,c=b.x,d=b.cy,e={x:c,y:d},f=a.P,g=a.N,h=[a];o(a);for(var i=f;i.circle&&T(c-i.circle.x)<_&&T(d-i.circle.cy)<_;)f=i.P,h.unshift(i),o(i),i=f;h.unshift(i),y(i);for(var j=g;j.circle&&T(c-j.circle.x)<_&&T(d-j.circle.cy)<_;)g=j.N,h.push(j),o(j),j=g;h.push(j),y(j);var k,l=h.length;for(k=1;l>k;++k)j=h[k],i=h[k-1],F(j.edge,i.site,j.site,e);i=h[0],j=h[l-1],j.edge=D(i.site,j.site,null,e),x(i),x(j)}function q(a){for(var b,c,d,e,f=a.x,g=a.y,h=Y._;h;)if(d=r(h,g)-f,d>_)h=h.L;else{if(e=f-s(h,g),!(e>_)){d>-_?(b=h.P,c=h):e>-_?(b=h,c=h.N):b=c=h;break}if(!h.R){b=h;break}h=h.R}var i=n(a);if(Y.insert(b,i),b||c){if(b===c)return y(b),c=n(b.site),Y.insert(i,c),i.edge=c.edge=D(b.site,i.site),x(b),void x(c);if(!c)return void(i.edge=D(b.site,i.site));y(b),y(c);var j=b.site,k=j.x,l=j.y,m=a.x-k,o=a.y-l,p=c.site,q=p.x-k,t=p.y-l,u=2*(m*t-o*q),v=m*m+o*o,w=q*q+t*t,z={x:(t*v-o*w)/u+k,y:(m*w-q*v)/u+l};F(c.edge,j,p,z),i.edge=D(j,a,null,z),c.edge=D(a,p,null,z),x(b),x(c)}}function r(a,b){var c=a.site,d=c.x,e=c.y,f=e-b;if(!f)return d;var g=a.P;if(!g)return-1/0;c=g.site;var h=c.x,i=c.y,j=i-b;if(!j)return h;var k=h-d,l=1/f-1/j,m=k/j;return l?(-m+Math.sqrt(m*m-2*l*(k*k/(-2*j)-i+j/2+e-f/2)))/l+d:(d+h)/2}function s(a,b){var c=a.N;if(c)return r(c,b);var d=a.site;return d.y===b?d.x:1/0}function t(a){this.site=a,this.edges=[]}function u(a){for(var b,c,d,e,f,g,h,i,j,k,l=a[0][0],m=a[1][0],n=a[0][1],o=a[1][1],p=X,q=p.length;q--;)if(f=p[q],f&&f.prepare())for(h=f.edges,i=h.length,g=0;i>g;)k=h[g].end(),d=k.x,e=k.y,j=h[++g%i].start(),b=j.x,c=j.y,(T(d-b)>_||T(e-c)>_)&&(h.splice(g,0,new G(E(f.site,k,T(d-l)<_&&o-e>_?{x:l,y:T(b-l)<_?c:o}:T(e-o)<_&&m-d>_?{x:T(c-o)<_?b:m,y:o}:T(d-m)<_&&e-n>_?{x:m,y:T(b-m)<_?c:n}:T(e-n)<_&&d-l>_?{x:T(c-n)<_?b:l,y:n}:null),f.site,null)),++i)}function v(a,b){return b.angle-a.angle}function w(){I(this),this.x=this.y=this.arc=this.site=this.cy=null}function x(a){var b=a.P,c=a.N;if(b&&c){var d=b.site,e=a.site,f=c.site;if(d!==f){var g=e.x,h=e.y,i=d.x-g,j=d.y-h,k=f.x-g,l=f.y-h,m=2*(i*l-j*k);if(!(m>=-ab)){var n=i*i+j*j,o=k*k+l*l,p=(l*n-j*o)/m,q=(i*o-k*n)/m,l=q+h,r=cb.pop()||new w;r.arc=a,r.site=e,r.x=p+g,r.y=l+Math.sqrt(p*p+q*q),r.cy=l,a.circle=r;for(var s=null,t=$._;t;)if(r.y<t.y||r.y===t.y&&r.x<=t.x){if(!t.L){s=t.P;break}t=t.L}else{if(!t.R){s=t;break}t=t.R}$.insert(s,r),s||(Z=r)}}}}function y(a){var b=a.circle;b&&(b.P||(Z=b.N),$.remove(b),cb.push(b),I(b),a.circle=null)}function z(a,b,c,d){return function(e){var f,g=e.a,h=e.b,i=g.x,j=g.y,k=h.x,l=h.y,m=0,n=1,o=k-i,p=l-j;if(f=a-i,o||!(f>0)){if(f/=o,0>o){if(m>f)return;n>f&&(n=f)}else if(o>0){if(f>n)return;f>m&&(m=f)}if(f=c-i,o||!(0>f)){if(f/=o,0>o){if(f>n)return;f>m&&(m=f)}else if(o>0){if(m>f)return;n>f&&(n=f)}if(f=b-j,p||!(f>0)){if(f/=p,0>p){if(m>f)return;n>f&&(n=f)}else if(p>0){if(f>n)return;f>m&&(m=f)}if(f=d-j,p||!(0>f)){if(f/=p,0>p){if(f>n)return;f>m&&(m=f)}else if(p>0){if(m>f)return;n>f&&(n=f)}return m>0&&(e.a={x:i+m*o,y:j+m*p}),1>n&&(e.b={x:i+n*o,y:j+n*p}),e}}}}}}function A(a){for(var b,c=W,d=z(a[0][0],a[0][1],a[1][0],a[1][1]),e=c.length;e--;)b=c[e],(!B(b,a)||!d(b)||T(b.a.x-b.b.x)<_&&T(b.a.y-b.b.y)<_)&&(b.a=b.b=null,c.splice(e,1))}function B(a,b){var c=a.b;if(c)return!0;var d,e,f=a.a,g=b[0][0],h=b[1][0],i=b[0][1],j=b[1][1],k=a.l,l=a.r,m=k.x,n=k.y,o=l.x,p=l.y,q=(m+o)/2,r=(n+p)/2;if(p===n){if(g>q||q>=h)return;if(m>o){if(f){if(f.y>=j)return}else f={x:q,y:i};c={x:q,y:j}}else{if(f){if(f.y<i)return}else f={x:q,y:j};c={x:q,y:i}}}else if(d=(m-o)/(p-n),e=r-d*q,-1>d||d>1)if(m>o){if(f){if(f.y>=j)return}else f={x:(i-e)/d,y:i};c={x:(j-e)/d,y:j}}else{if(f){if(f.y<i)return}else f={x:(j-e)/d,y:j};c={x:(i-e)/d,y:i}}else if(p>n){if(f){if(f.x>=h)return}else f={x:g,y:d*g+e};c={x:h,y:d*h+e}}else{if(f){if(f.x<g)return}else f={x:h,y:d*h+e};c={x:g,y:d*g+e}}return a.a=f,a.b=c,!0}function C(a,b){this.l=a,this.r=b,this.a=this.b=null}function D(a,b,c,d){var e=new C(a,b);return W.push(e),c&&F(e,a,b,c),d&&F(e,b,a,d),X[a.i].edges.push(new G(e,a,b)),X[b.i].edges.push(new G(e,b,a)),e}function E(a,b,c){var d=new C(a,null);return d.a=b,d.b=c,W.push(d),d}function F(a,b,c,d){a.a||a.b?a.l===c?a.b=d:a.a=d:(a.a=d,a.l=b,a.r=c)}function G(a,b,c){var d=a.a,e=a.b;this.edge=a,this.site=b,this.angle=c?Math.atan2(c.y-b.y,c.x-b.x):a.l===b?Math.atan2(e.x-d.x,d.y-e.y):Math.atan2(d.x-e.x,e.y-d.y)}function H(){this._=null}function I(a){a.U=a.C=a.L=a.R=a.P=a.N=null}function J(a,b){var c=b,d=b.R,e=c.U;e?e.L===c?e.L=d:e.R=d:a._=d,d.U=e,c.U=d,c.R=d.L,c.R&&(c.R.U=c),d.L=c}function K(a,b){var c=b,d=b.L,e=c.U;e?e.L===c?e.L=d:e.R=d:a._=d,d.U=e,c.U=d,c.L=d.R,c.L&&(c.L.U=c),d.R=c}function L(a){for(;a.L;)a=a.L;return a}function M(a,b){var c,d,e,f=a.sort(N).pop();for(W=[],X=new Array(a.length),Y=new H,$=new H;;)if(e=Z,f&&(!e||f.y<e.y||f.y===e.y&&f.x<e.x))(f.x!==c||f.y!==d)&&(X[f.i]=new t(f),q(f),c=f.x,d=f.y),f=a.pop();else{if(!e)break;p(e.arc)}b&&(A(b),u(b));var g={cells:X,edges:W};return Y=$=W=X=null,g}function N(a,b){return b.y-a.y||b.x-a.x}function O(a){return a[0]}function P(a){return a[1]}function Q(a,b,c){return(a.x-c.x)*(b.y-a.y)-(a.x-b.x)*(c.y-a.y)}var R={version:"3.4.3"};R.ascending=function(a,b){return b>a?-1:a>b?1:a>=b?0:0/0},R.descending=function(a,b){return a>b?-1:b>a?1:b>=a?0:0/0},R.min=function(a,b){var c,d,e=-1,f=a.length;if(1===arguments.length){for(;++e<f&&!(null!=(c=a[e])&&c>=c);)c=void 0;for(;++e<f;)null!=(d=a[e])&&c>d&&(c=d)}else{for(;++e<f&&!(null!=(c=b.call(a,a[e],e))&&c>=c);)c=void 0;for(;++e<f;)null!=(d=b.call(a,a[e],e))&&c>d&&(c=d)}return c},R.max=function(a,b){var c,d,e=-1,f=a.length;if(1===arguments.length){for(;++e<f&&!(null!=(c=a[e])&&c>=c);)c=void 0;for(;++e<f;)null!=(d=a[e])&&d>c&&(c=d)}else{for(;++e<f&&!(null!=(c=b.call(a,a[e],e))&&c>=c);)c=void 0;for(;++e<f;)null!=(d=b.call(a,a[e],e))&&d>c&&(c=d)}return c},R.extent=function(a,b){var c,d,e,f=-1,g=a.length;if(1===arguments.length){for(;++f<g&&!(null!=(c=e=a[f])&&c>=c);)c=e=void 0;for(;++f<g;)null!=(d=a[f])&&(c>d&&(c=d),d>e&&(e=d))}else{for(;++f<g&&!(null!=(c=e=b.call(a,a[f],f))&&c>=c);)c=void 0;for(;++f<g;)null!=(d=b.call(a,a[f],f))&&(c>d&&(c=d),d>e&&(e=d))}return[c,e]},R.sum=function(a,b){var c,d=0,e=a.length,f=-1;if(1===arguments.length)for(;++f<e;)isNaN(c=+a[f])||(d+=c);else for(;++f<e;)isNaN(c=+b.call(a,a[f],f))||(d+=c);return d},R.mean=function(b,c){var d,e=b.length,f=0,g=-1,h=0;if(1===arguments.length)for(;++g<e;)a(d=b[g])&&(f+=(d-f)/++h);else for(;++g<e;)a(d=c.call(b,b[g],g))&&(f+=(d-f)/++h);return h?f:void 0},R.quantile=function(a,b){var c=(a.length-1)*b+1,d=Math.floor(c),e=+a[d-1],f=c-d;return f?e+f*(a[d]-e):e},R.median=function(b,c){return arguments.length>1&&(b=b.map(c)),b=b.filter(a),b.length?R.quantile(b.sort(R.ascending),.5):void 0},R.bisector=function(a){return{left:function(b,c,d,e){for(arguments.length<3&&(d=0),arguments.length<4&&(e=b.length);e>d;){var f=d+e>>>1;a.call(b,b[f],f)<c?d=f+1:e=f}return d},right:function(b,c,d,e){for(arguments.length<3&&(d=0),arguments.length<4&&(e=b.length);e>d;){var f=d+e>>>1;c<a.call(b,b[f],f)?e=f:d=f+1}return d}}};var S=R.bisector(function(a){return a});R.bisectLeft=S.left,R.bisect=R.bisectRight=S.right,R.shuffle=function(a){for(var b,c,d=a.length;d;)c=Math.random()*d--|0,b=a[d],a[d]=a[c],a[c]=b;return a},R.permute=function(a,b){for(var c=b.length,d=new Array(c);c--;)d[c]=a[b[c]];return d},R.pairs=function(a){for(var b,c=0,d=a.length-1,e=a[0],f=new Array(0>d?0:d);d>c;)f[c]=[b=e,e=a[++c]];return f},R.zip=function(){if(!(e=arguments.length))return[];for(var a=-1,c=R.min(arguments,b),d=new Array(c);++a<c;)for(var e,f=-1,g=d[a]=new Array(e);++f<e;)g[f]=arguments[f][a];return d},R.transpose=function(a){return R.zip.apply(R,a)},R.keys=function(a){var b=[];for(var c in a)b.push(c);return b},R.values=function(a){var b=[];for(var c in a)b.push(a[c]);return b},R.entries=function(a){var b=[];for(var c in a)b.push({key:c,value:a[c]});return b},R.merge=function(a){for(var b,c,d,e=a.length,f=-1,g=0;++f<e;)g+=a[f].length;for(c=new Array(g);--e>=0;)for(d=a[e],b=d.length;--b>=0;)c[--g]=d[b];return c};var T=Math.abs;R.range=function(a,b,d){if(arguments.length<3&&(d=1,arguments.length<2&&(b=a,a=0)),(b-a)/d===1/0)throw new Error("infinite range");var e,f=[],g=c(T(d)),h=-1;if(a*=g,b*=g,d*=g,0>d)for(;(e=a+d*++h)>b;)f.push(e/g);else for(;(e=a+d*++h)<b;)f.push(e/g);return f},R.map=function(a){var b=new e;if(a instanceof e)a.forEach(function(a,c){b.set(a,c)});else for(var c in a)b.set(c,a[c]);return b},d(e,{has:f,get:function(a){return this[U+a]},set:function(a,b){return this[U+a]=b},remove:g,keys:h,values:function(){var a=[];return this.forEach(function(b,c){a.push(c)}),a},entries:function(){var a=[];return this.forEach(function(b,c){a.push({key:b,value:c})}),a},size:i,empty:j,forEach:function(a){for(var b in this)b.charCodeAt(0)===V&&a.call(this,b.substring(1),this[b])}});var U="\x00",V=U.charCodeAt(0);R.nest=function(){function a(b,h,i){if(i>=g.length)return d?d.call(f,h):c?h.sort(c):h;for(var j,k,l,m,n=-1,o=h.length,p=g[i++],q=new e;++n<o;)(m=q.get(j=p(k=h[n])))?m.push(k):q.set(j,[k]);return b?(k=b(),l=function(c,d){k.set(c,a(b,d,i))}):(k={},l=function(c,d){k[c]=a(b,d,i)}),q.forEach(l),k}function b(a,c){if(c>=g.length)return a;var d=[],e=h[c++];return a.forEach(function(a,e){d.push({key:a,values:b(e,c)})}),e?d.sort(function(a,b){return e(a.key,b.key)}):d}var c,d,f={},g=[],h=[];return f.map=function(b,c){return a(c,b,0)},f.entries=function(c){return b(a(R.map,c,0),0)},f.key=function(a){return g.push(a),f},f.sortKeys=function(a){return h[g.length-1]=a,f},f.sortValues=function(a){return c=a,f},f.rollup=function(a){return d=a,f},f},R.set=function(a){var b=new k;if(a)for(var c=0,d=a.length;d>c;++c)b.add(a[c]);return b},d(k,{has:f,add:function(a){return this[U+a]=!0,a},remove:function(a){return a=U+a,a in this&&delete this[a]},values:h,size:i,empty:j,forEach:function(a){for(var b in this)b.charCodeAt(0)===V&&a.call(this,b.substring(1))}}),R.functor=l;var W,X,Y,Z,$,_=(Math.PI,1e-6),ab=_*_,bb=[],cb=[];t.prototype.prepare=function(){for(var a,b=this.edges,c=b.length;c--;)a=b[c].edge,a.b&&a.a||b.splice(c,1);return b.sort(v),b.length},G.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a}},H.prototype={insert:function(a,b){var c,d,e;if(a){if(b.P=a,b.N=a.N,a.N&&(a.N.P=b),a.N=b,a.R){for(a=a.R;a.L;)a=a.L;a.L=b}else a.R=b;c=a}else this._?(a=L(this._),b.P=null,b.N=a,a.P=a.L=b,c=a):(b.P=b.N=null,this._=b,c=null);for(b.L=b.R=null,b.U=c,b.C=!0,a=b;c&&c.C;)d=c.U,c===d.L?(e=d.R,e&&e.C?(c.C=e.C=!1,d.C=!0,a=d):(a===c.R&&(J(this,c),a=c,c=a.U),c.C=!1,d.C=!0,K(this,d))):(e=d.L,e&&e.C?(c.C=e.C=!1,d.C=!0,a=d):(a===c.L&&(K(this,c),a=c,c=a.U),c.C=!1,d.C=!0,J(this,d))),c=a.U;this._.C=!1},remove:function(a){a.N&&(a.N.P=a.P),a.P&&(a.P.N=a.N),a.N=a.P=null;var b,c,d,e=a.U,f=a.L,g=a.R;if(c=f?g?L(g):f:g,e?e.L===a?e.L=c:e.R=c:this._=c,f&&g?(d=c.C,c.C=a.C,c.L=f,f.U=c,c!==g?(e=c.U,c.U=a.U,a=c.R,e.L=a,c.R=g,g.U=c):(c.U=e,e=c,a=c.R)):(d=a.C,a=c),a&&(a.U=e),!d){if(a&&a.C)return void(a.C=!1);do{if(a===this._)break;if(a===e.L){if(b=e.R,b.C&&(b.C=!1,e.C=!0,J(this,e),b=e.R),b.L&&b.L.C||b.R&&b.R.C){b.R&&b.R.C||(b.L.C=!1,b.C=!0,K(this,b),b=e.R),b.C=e.C,e.C=b.R.C=!1,J(this,e),a=this._;break}}else if(b=e.L,b.C&&(b.C=!1,e.C=!0,K(this,e),b=e.L),b.L&&b.L.C||b.R&&b.R.C){b.L&&b.L.C||(b.R.C=!1,b.C=!0,J(this,b),b=e.L),b.C=e.C,e.C=b.L.C=!1,K(this,e),a=this._;break}b.C=!0,a=e,e=e.U}while(!a.C);a&&(a.C=!1)}}},R.geom={},R.geom.voronoi=function(a){function b(a){var b=new Array(a.length),d=h[0][0],e=h[0][1],f=h[1][0],g=h[1][1];return M(c(a),h).cells.forEach(function(c,h){var i=c.edges,j=c.site,k=b[h]=i.length?i.map(function(a){var b=a.start();return[b.x,b.y]}):j.x>=d&&j.x<=f&&j.y>=e&&j.y<=g?[[d,g],[f,g],[f,e],[d,e]]:[];k.point=a[h]}),b}function c(a){return a.map(function(a,b){return{x:Math.round(f(a,b)/_)*_,y:Math.round(g(a,b)/_)*_,i:b}})}var d=O,e=P,f=d,g=e,h=db;return a?b(a):(b.links=function(a){return M(c(a)).edges.filter(function(a){return a.l&&a.r}).map(function(b){return{source:a[b.l.i],target:a[b.r.i]}})},b.triangles=function(a){var b=[];return M(c(a)).cells.forEach(function(c,d){for(var e,f,g=c.site,h=c.edges.sort(v),i=-1,j=h.length,k=h[j-1].edge,l=k.l===g?k.r:k.l;++i<j;)e=k,f=l,k=h[i].edge,l=k.l===g?k.r:k.l,d<f.i&&d<l.i&&Q(g,f,l)<0&&b.push([a[d],a[f.i],a[l.i]])}),b},b.x=function(a){return arguments.length?(f=l(d=a),b):d},b.y=function(a){return arguments.length?(g=l(e=a),b):e},b.clipExtent=function(a){return arguments.length?(h=null==a?db:a,b):h===db?null:h},b.size=function(a){return arguments.length?b.clipExtent(a&&[[0,0],a]):h===db?null:h&&h[1]},b)};var db=[[-1e6,-1e6],[1e6,1e6]];"function"==typeof define&&define.amd?define(R):"object"==typeof module&&module.exports?module.exports=R:this.d3=R}(),Shatter.prototype.getPolys=function(a,b,c){var d=d3.range(c).map(function(){return[Math.random()*a,Math.random()*b]}),e=d3.geom.voronoi().clipExtent([[0,0],[a,b]]),f=e(d);return console.log("Polygons is "+f),f},Shatter.prototype.roundVertices=function(a){a.forEach(function(a){a.forEach(function(a){a[0]=Math.round(a[0]),a[1]=Math.round(a[1])})})},Shatter.prototype.scaleCoordinates=function(a,b){var b=b;a.forEach(function(a){a.points=[];var c=(a.maxX+a.minX)/2,d=(a.maxY+a.minY)/2;a.forEach(function(e){var f=e[0]-a.minX,g=e[1]-a.minY;f=Math.round(b*(f-c)+c),g=Math.round(b*(g-d)+d),a.points.push(f,g)})})},Shatter.prototype.calcBoundaries=function(a,b){a.forEach(function(a){a.minX=b.width,a.minY=b.height,a.maxX=0,a.maxY=0,a.forEach(function(b){a.minX=b[0]<a.minX?b[0]:a.minX,a.minY=b[1]<a.minY?b[1]:a.minY,a.maxX=b[0]>a.maxX?b[0]:a.maxX,a.maxY=b[1]>a.maxY?b[1]:a.maxY})})},Shatter.prototype.spliceImage=function(a,b){imageList=[];var c=document.createElement("canvas");c.width=b.width,c.height=b.height;var d=c.getContext("2d");return d.save(),a.forEach(function(a){a.forEach(function(a,e,f){if(0===e)return d.beginPath(),void d.moveTo(a[0],a[1]);if(d.lineTo(a[0],a[1]),e===f.length-1){d.lineTo(f[0][0],f[0][1]),d.clip(),d.drawImage(b,0,0);var g=new Image;g.src=c.toDataURL("image/png");var h=f.maxY-f.minY,i=f.maxX-f.minX,j=document.createElement("canvas");j.width=i,j.height=h,cropCtx=j.getContext("2d"),cropCtx.drawImage(g,-f.minX,-f.minY);var k=new Image;return k.src=j.toDataURL("image/png"),imageList.push({image:k,x:f.minX,y:f.minY,points:f.points}),g=null,k=null,j=null,d.restore(),d.clearRect(0,0,250,250),void d.save()}})}),canvas=null,imageList};